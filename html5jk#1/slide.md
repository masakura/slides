# 題名未定
本日は HTML5 アプリを作り始める時に覚えておいた方がいいことをささーっとやります。あと、脈絡もなく断片的に話をします。ですので、フレームワークのお話などのより実践的なものはあまり出てきません。ごめんなさい。

また、ささーっとやりますので、細かいところは検索して調べることをお勧めします。


## 大体の流れ
こういう感じでお話しします。

* HTML5 の概要のお話 (5 で何が変わったか? どういうことができるのか? 実例の紹介)
* HTML5 アプリに関するお話 (SPA がどうとか、コードが増える分問題が出やすいよとか)
* HTML5 アプリの開発環境紹介 (簡易ウェブサーバー -> Yeoman -> Plunker)


## HTML5 のお話 (第一部第一章)
やること。

* HTML4 -> HTML5 で何が変わったかのかの説明 (私はアプリを作るのもミッションになったのが大きいと思う)
* HTML5 では何ができるのか?
* HTML5 を使ったアプリの紹介


### HTML4 から HTML5 で何が変わったか?
HTML4 から HTML5 って何が変わったのでしょうか?

いろいろと変わったのですべてを挙げることは難しいのですが、私が一番重要だと思う変更は、「アプリを書くのも HTML のミッションになった」ことです。(`も` が意外と大事です)

もちろん、HTML4 でもアプリは作れますし、実際に Google Map のような素晴らしいアプリがあります。ですが、「アプリを書くのも HTML のミッションになった」ことで、HTML4 時代では作れないようなアプリも作れるような規格になるということです。

もちろん、HTML でアプリを作れるようになる必要があるのか? ネイティブアプリでもいいのでは? みたいなお話もあります。ですが、古いところは Java アプレットや Flash、新しいところは Silverlight など、ウェブのメリットを活かしたアプリを作ろうという動きは昔からあります。

いろいろありましたが、今は様々な企業が HTML5 で一緒にやっていくことで合意しています。


### HTML5 でできること
HTML5 で何ができるのかは非常に難しいです。現在仕様策定中のものもたくさんあります。[Can I use](http://caniuse.com/) を見ると本当にいっぱいあって困ってしまいますね!

比較的当たり前に使われているものは、

* Canvas
* SVG (HTML5?)
* Geolocation
* Web Storage
* Video/Audio Element
* Application Cache (評判悪いですが...)

あたりでしょうか?

最近ですと、

* WebRTC
* Web Components
* Web Audio API/Web MIDI API
* ServiceWorker

などが流行っているようです。

たくさんありすぎて紹介しきれません! ゲームコントローラーも繋げられるようですし、バッテリー残量を取得することもできます。


### HTML5 を使ったアプリを紹介
* [WebWRTC Chat on SkyWay](https://chat.skyway.io/)
* [Unity WebGL Benchmarks](http://beta.unity3d.com/jonas/WebGLBenchmark/)
* [Web Audio API demo](https://chromium.googlecode.com/svn/trunk/samples/audio/samples.html)


### HTML5 モバイルアプリの展開
#### Chrome Mobile
もし、お手元に Android があれば、Chrome Mobile には`ホーム画面に追加`というボタンがあるのを見てください。それを押すと、ホーム画面に登録さます。

さらに Web Manifest (manifest.json) というものを書くと、アイコンを使えたりブラウザーをフルスクリーンで表示させたりもできます。

Service Worker を使ってオフライン動作やバックグラウンド動作も組み込めば、ネイティブアプリにかなり近いエクスペリエンスを提供できます。


#### Firefox OS
OS そのものにブラウザーエンジンの Firefox を流用したスマフォ用の OS です。ホーム画面の UI からアプリまですべて HTML5 アプリです。

アプリはウェブサーバーに配置して動かすホスト型の他に、Android/iOS でお馴染みのストア経由で配布するパッケージ型があります。このどちらも HTML5 で書けるというのがすごいです。

また、Firefox OS のマーケットプレイスの Firefox Marketplace に Firefox でアクセスすることで Firefox OS 以外の OS でも利用することができます。ということは、Firefox OS 向けにアプリを書いておけば、Android・Windows (Desktop)・Mac などでも動作するということになります。


### まとめ
HTML5 は「アプリを作るのもミッションの一つ」です。アプリを作れるようにするため、様々な機能が追加されていますし、現在進行形で追加されていってます。

HTML5 アプリはブックマークするだけでなくて、スマフォとかのホーム画面に貼り付けられるし、Firefox OS みたいにホーム画面そのものが HTML5 アプリなものもあるよ!

詳しいことは、HTML5 Conference 2015 in 鹿児島の吉川さんのビデオを見ると良いよ!


## HTML5 でアプリを作るときの注意 (第一部第二章)
SPA のお話と、今までのウェブアプリと違い、JavaScript のコードが増える分、いろんな問題が出るよーというお話。だから、MV* フレームワーク使おうねとか。

* SPA で書く
* JavaScript のコードの量が飛躍的に多くなるから、気をつけてね
* MV* フレームワークを使う (今日はやりません)
* Strict モードと即時実行とか
* コーディング規約


## HTML5 アプリ開発環境あれこれ (第一部第三章)
すぐに使い始められる Plunker から、簡易ウェブサーバーと Bower を組み合わせた方法、Yeoman を使った方法を紹介します。


## メモレベル
ここはなぐり書き。


### HTML4 と HTML5 の違い
細かいお話は調べれば出てきますので... 大雑把に言うと、HTML4 まではあくまでドキュメントを書くための言語だったのに対し、HTML5 からはアプリを作ることも (`も`に注意ね) ミッションのひとつになっていることです。

HTML5 Conference 2015 in 鹿児島の吉川さんの講義を見ると大変参考になります。信じられないようなことができたりしますので、帰ってから一度見てみることをお勧めします!

アプリを作るために何が必要か? と考えた時に、Cookie じゃとてもアプリのデータを保存するのはできないので Web Storage みたいな仕組みを導入しよう! のような流れで、HTML5 へどんどん機能が追加されて行っています。

最近ですと、以下のものが流行りのようです。

* WebRTC/ORTC
* Web Components
* Web Audio API/Web MIDI API

他にもたくさんあって紹介しきれません! ゲームコントローラーも繋げられますし、何ができるのかは自分もよく分からないです。

[Can I use ?](http://caniuse.com/) を見るとブラウザー毎の実装状況が分かりますが、本当に多いですね...

HTML5 はどんどん進化を続けます! それ Flash 使わないとできませんとか、ネイティブじゃないとできませんのようなことはどんどんなくなっていきます。


### HTML5 API を使ったアプリの紹介
* [WebWRTC Chat on SkyWay](https://chat.skyway.io/)
* [Unity WebGL Benchmarks](http://beta.unity3d.com/jonas/WebGLBenchmark/)
* [Web Audio API demo](https://chromium.googlecode.com/svn/trunk/samples/audio/samples.html)


### 開発者視点から見た今までの Web アプリと HTML5 アプリの違い
今までの PHP や Ruby on Rails などを利用したウェブアプリと HTML5 アプリの一番の違いはどこでコードが動作するか? です。今までのウェブアプリではほとんどのコードがサーバー側で実行されていましたが、HTML5 アプリではブラウザー側で動作するコードが圧倒的に多くなります。

その結果、ブラウザー側に求められる機能が多くなり、それらはライブラリやフレームワークという形で提供されることになりました。それに加え、HTML5 アプリでネイティブアプリのようなこともできるようにということで、HTML5/CSS3/JavaScript を進化させることにつながっています。

これらの変化により、JavaScript のコードの量が飛躍的に増大します。


### Single Page Application
今までのウェブアプリでは、一画面につき一 HTML のようなスタイルで書いていましたが、HTML5 アプリでは Single Page Application (SPA) という一枚の index.html だけでアプリを書くのが主流になっています。

今までのウェブアプリの JavaScript は操作を助けたりする目的で、そんなに大きなものではありません。ですので、JavaScriptコードのロードの時間もそれほど気にする必要はありませんでした。HTML5 アプリの場合、JavaScript のコードの量が大きくなりますので、ページを遷移するたびに新しく HTML ファイルを読み込んでいては非常に遅くなります。

SPA で HTML5 アプリを組むことで、HTML5/CSS3/JavaScript などのロードをページ遷移ごとに全部行うことを防ぐことができます。アプリの規模が大きくなるほど、この差は顕著になります。

なお、ページ遷移の際に URL を書き換えるため、History API というものを用います。ですが、ほとんどの場合、AngularJS や Backbone.js のようななんらかの MVC フレームワークを使用し、それに従うのが良いでしょう。

ToDo 実際に URL が変化する実例を見せた方がいいと思う

SPA なんて特別な言葉を使いましたけど、クライアントサイドでただ単にアプリが動くだけですね。構造的には Visual Basic などで書かれていたアプリとそれほど変わるものではありません。(ただ、昔とはアプリの規模が違いますけどね)


### 開発者ツールを使いこなせ!
HTML5 アプリではブラウザー上で動作するコードが増えるため、今までよりも開発者ツールを使いこなさないといけません。開発者ツールの機能を簡単にデモをします。ただ、自分よりウェブ屋さんの方が詳しいと思いますので、全部知ってることだったらごめんなさい。

今日は Google Chrome Developer Tools を使いますが、他のブラウザーでもだいたい同じことができます。


### ベータ版ブラウザーも使おう!
Google Chrome に対する Chrome Canary や、Firefoxに対する Firefox Developer Edition などのようなちょっと先の実装のブラウザーを使うのもわりとお勧めです。もちろん、常用するのではなく、最先端の HTML5 API を触る時は大変有用です。

より最先端のものを触りたい時は Nightly Build を使いましょう!


### HTML5 API をあまり直接使わないこと
最近の HTML5 API は Extensible Web という考え方で作られています。ブラウザーは要件を満たす低レベルな API を用意し、開発者が使うライブラリで簡便さを実現するような仕組みです。

要件が少しでも外れたらそれは使いにくい API になってしまいます。ブラウザー側で要件に近い高レベルな API を用意すると、ブラウザーがアップデートされるまでは対処できないといったことになります。そのあたりを、まだ修正や配布が容易なライブラリ側に任せることで、いち早く使えるものを提供できるようになっています。

HTML5 API を直接触った方ならお分かりだと思いますが、意外と面倒なんですね。これは、こういった理由で意図的に面倒に作られています。

ですので、一般的には HTML5 API を直接使うのではなく、より便利なライブラリを探してきてそれを使うようにしてください。

* WebRTC -> PeerJS/SkyWay
* WebGL -> Three.js
* WebComponents -> Polymer


### Strcit モードと無名関数の即時実行
HTML5 アプリでは JavaScript のコードが飛躍的に増えるのはお話した通りです。そのせいで、規模が小さいうちは大した問題にならないことが、HTML5 アプリでは大きな問題になります。

それを解決する手段はさまざまですが、本日は Strict モードと無名関数の即時実行を紹介します。(どちらも有用ですので、既に使われている方もいらっしゃると思います)


#### Strict モード
細かい話は置いておいて...

```javascript
var document = 'hoge';

console.log(document);
```

このコードを実行するとどうなると思います?

正解は `document` オブジェクトが表示されます。

一行目の変数の初期化はグローバルスコープで行われているため、`window.document` プロパティへの代入として実行されます。ですが、`window.document` プロパティは読み取り専用ですので、結果として `hoge` は設定されずに動作し、(スルーされるのがびっくりですよ!) 結果として `document` オブジェクトが表示されます。

以下のように `'use strict';` を書くことで Strict モードで動作するようになり、`var documment = 'hoge';` で例外が発生し、プログラムは停止します。

```javascript
'use strict';

var document = 'hoge';

console.log(document);
```

Strict モードにはこれ以外のたくさんの違いがありますので、コードを何百行も書いてから Strict モードに変えようということはかなり難しいです。確実に動きません。ですので最初から Strict モードを使う癖をつけましょう。


#### 無名関数の即時実行
ToDo 日付を書く

この前 ECMAScript6 が勧告されましたが、今のブラウザーで使えるのはほとんどの場合 ECMAScript5 です。ECMAScript5 では、他の一般的な言語と異なり関数でしかスコープを作ることができませんです。

ですので、スコープが欲しい時は、関数を書いて、その場で実行するという手段を取る必要があります。この関数は名前がある必要がありませんので、無名関数として宣言しそのまま実行するようなことを行います。

```javascript
(function () {
  // ここに処理を書く...
})();
```

書き方は他にもありますが、これが主流なのでこの書き方で揃えましょう!

なお、先ほど紹介した Strict モードもスコープで有効になります。グローバルスコープで `'use strict';` を書くと、読み込んだすべての JavaScript ライブラリが Strict モードで動作することになります。中には Strict モードではうまく動作しないライブラリもありますので、Strict モードの宣言も、関数スコープの中で行った方がいいです。

```javascript
(function () {
  'use strict';

  // ここに処理を書く...
})();
```

### その他注意事項
ウェブ系の開発者にとっては当たり前かもしれませんが、文字コードは UTF-8 (BOM なし) で、改行コードが LF のみというのが主流のようです。

Windows でよく使われているエディターの中には Shift_JIS や UTF-8 でも BOM をつけたり、概要コードが CRLF なものもありますのでご注意ください。


## 開発ツールの紹介メモレベル
### 簡易ウェブサーバーを使おう!
HTML5 アプリなので、index.html を書いてウェブブラウザーで開けばすぐに表示することができます。ですが、一部 `file:///` スキームだと動かないものがありますので、簡易ウェブサーバーを使うのをおすすめします。

HTML5 アプリを開発するためのツールは Node.js という JavaScript の実行環境で動作するものが多いですので、今日はそれで動く http-server というものを使ってみます。

Node.js で動作するツールのインストールは `npm` を使って簡単にできます。

```
npm install -g http-server
```

Mac の方で、公式ページから Node.js をインストールした人は `sudo` が必要かもしれません。

```
sudo npm install -g http-server
```

実際に使ってみましょう!

```
mkdir app1
cd app1
echo hoge > index.html
http-server
```

そして、ブラウザーを起動してアドレスバーに `http://localhost:8080/` と入力してください。そうすると `hoge` と表示されると思います。

`localhost` の代わりに自分の IP Address を使うと、他人に見せることができます。試しに `http://{ip address}:8080/` にアクセスしてみてください。私のが見れます。

以下のようにすると、ポート番号は `9000` で自分の端末からしか繋がらなくなり、`app-path` ディレクトリをルートとして起動します。

```
http-server -p 9000 -a 127.0.0.1 app-path
```

簡易ウェブサーバーはいろいろありますので、`http-server` でなくても構いません。使い慣れたもののほうがよいでしょう!

* Python 2.7
* Python 3
* Ruby
* PHP
* Windows -> IIS Express


### Bower の紹介
HTML5 アプリを開発しようとするとたくさんのライブラリを読み込む必要があります。それらをダウンロードしてきてくれる便利なツールが Bower です。

実際にやってみたほうがわかりやすいと思いますので、細かいことは考えずにやりましょう!

まずは、起動している `http-server` を Ctrl + C で止めてください。

`bower init` で Bower プロジェクトを作ります。質問には適当に答えてください。

```
bower init
```

`bower install --save` で `jQuery` をインストールしてみます。`--save` を忘れないでください!

```
bower install --save jquery
```

これで、インターネットから `jQuery` をダウンロードしてきます。そして、それが読み込まれるように `index.html` を書いて、実際に `jQuery` を使ったコードを書いてみます。

```html
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8"/>
    <title>Document</title>
    <script src="bower_components/jquery/jquery.js"></script>
  </head>
  <body>
    <h1>hogehoge</h1>
    <script>
      alert($('h1').text());
    </script>
  </body>
</html>
```

`jQuery` だけをインストールするためになんて面倒な! と思ったかもしれません。`Bower` はインストールしたライブラリの復元機能があります。

試しに `bower.json` ファイルを覗いてみてください。インストールしたライブラリが記述されています。`bower_components` ディレクトリを消してから `bower install` を実行してください。

```
bower install
```

見事にライブラリが復活しました! バージョン管理をするときは `bower_components` を無視リストに入れておくと便利です。

`Bower` はライブラリの依存関係を考慮してダウンロードします。ライブラリによっては依存関係がたくさんあり、あれもこれもダウンロードしないといけないなどありますが、`Bower` なら全部持ってきてくれます。

また、最近、チュートリアルなどで `Bower` を使ってライブラリをダウンロードするように書かれているものも増えてきました。覚えておくと、チュートリアルに集中できますので、ぜひ `Bower` を覚えましょう!


### Yeoman の紹介
簡易ウェブサーバーは簡単に使えるので非常に便利なのですが、HTML5 アプリの開発を行うのには `Yeoman` というもっと便利なものがあります。`Bower` も実は Yeoman を構成するツールの一つです。

`Yeoman` は、スキャフォールディングツールの `yo`、タスクランナーの `Grunt` もしくは `gulp`、パッケージマネージャーの `Bower` の三つから構成されます。

先ほど、`Bower` を使ってライブラリをダウンロードしましたが、例えば 10 個ダウンロードしたら `<script src="...">` を 10 個書かないといけませんよね。もしかしたらそれ以上かもしれません。タスクランナーの `Grunt` や `gulp` にはこの `<script src="...">` を勝手に追加してくれる便利なタスクが用意されています。

他にも、ネットワークトラフィックを低減するための圧縮や、通信回数を減らすためのファイル結合など、たくさんの便利なタスクが用意されています。

ですが、タスクを一つ一つ設定していくことはかなり大変ですので、(普通に数百行になります) プロジェクトをテンプレートから生成するスキャフォールディングツールの `yo` を使います。

本日は時間の節約のため、`Yeoman` は紹介のみにとどめておきます。もし、興味がある方は第二部の方で試されてみてください。

まずはプロジェクトを作ります。

```
mkdir app2
cd app2
yo webapp --test-framework=jasmine --no-babel
```

一番便利なのが `BrowserSync` です。

```
grunt serve
```

エディターで `index.html` を修正して保存すると、即座にブラウザーに反映されます! ブラウザーのリロードボタンを押せばいいでしょと思われるかもしれませんが、慣れるとやみつきになります。

`BrowserSync` は他にも便利な機能があり、その一つが操作の伝播です。

```html
<div class="input-group">
  <input id="input1" type="text" class="form-control">
  <span class="input-group-btn">
    <button id="button1" type="button" class="btn btn-primary">
      Push
    </button>
  </span>
</div>
<div id="result"></div>
```

```javascript
$(document).on('click', '#button1', function () {
  $('#result').text($('#input1').val());
});
```

興味がある方は、`http://{ip address}:9000/` にアクセスしてみてください。ただしブラウザーは触らないでくださいね! 私が操作しますので!

`Bower` でのライブラリの追加も簡単です。

```
bower install --save underscore
```

これで `Underscore.js` のインストールは終わりです。`index.html` を見ると、`Underscore.js` を読み込む `<script>` 要素が自動で挿入されます。

これは開発用ですが、実際にサーバーにアップロードする成果物を作るためには `grunt build` を実行します。

```
grunt build
```

これで `dist` ディレクトリに成果物が出来上がります。当然ファイル圧縮済みです!

`Yeoman` を使うと、現実的な HTML5 アプリの開発環境が簡単に手に入ります。皆さん一度お試しあれ!

今回は `generator-webapp` というジェネレーターを使いましたが、`Yeoman` のジェネレーターはたくさんあります。[Generators | Yeoman](http://yeoman.io/generators/) で探してみてください。


### ブラウザーのみで完結する開発環境もあります!
`Yeoman` や簡易ウェブサーバーは大変便利です。しかし、もっとお手軽にやりたい時もあると思います。

そういう時に便利なのが、ブラウザーだけで完結する開発環境です。今回は [Plunker](http://plnkr.co/) を使ってみましょう!

[Plunker の公式サイト](http://plnkr.co/)にアクセスし、右上の `Sign in with Github` ボタンをクリックします。GitHub のサイトに移動して、`Plunker` に権限を与えるか聞いてきますので、許可をしてください。

ちょっと余談ですが、GitHub を認証に使う開発者向けサービスは多いです。結構便利です。

ログインができたら、`Launch the Editor` ボタンをクリックしてください。開発用の画面になります。

* せっかくなので、左の方にある `private plunk` チェックボックスを外しましょう!
* `Run` ボタンをクリックします
* `Hello Plunker!` を `Hello, world!` とか適当に書き換えてください
* `Save` ボタンで保存します

右上の自分の名前の左に `Open the embedded view` ボタンをクリックしてください。別ウインドウで表示されます。この時、アドレスバーにある URL を人に送れば、見せびらかすことができます!

* 右側の目のアイコンの下、`Find and external libraries` ボタンをクリックしてください
* `search packages...` に `jquery` と書き、虫眼鏡ボタンを押します
* 表示された結果の `jquery` の `2.1.4` をクリックし、`Add` ボタンを押すと、`jQuery` が使えるようになります

こんな感じでブラウザーだけで完結するので、ちょこっとしたものを作ったり、すぐに人に見せたいときに大変便利です。ご丁寧に SNS ボタンまでありますね!

本日の第二部はこの `Plunker` を使います。今からちょっと長めの休憩時間に入りますので、休憩を取りつつ、少し使ってみてください。

こういったサービスは他にもありますので、ぜひどうぞ!

* jsdo.it - 日本の会社の面白法人カヤックさんが作ってるので、日本語 UI!
* CodePen - HTML/CSS/JavaScript ファイルを一画面で表示できる!
* Monaca - 日本の会社のアシアルさんが作ってる、ハイブリッドアプリ開発ができるやつ!
